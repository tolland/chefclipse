<?xml version="1.0" encoding="UTF-8"?>
<project
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
  xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <modelVersion>4.0.0</modelVersion>

   <parent>
    <groupId>org.limepepper.chefclipse</groupId>
    <artifactId>org.limepepper.chefclipse</artifactId>
    <version>1.0.0-SNAPSHOT</version>
    <relativePath>../</relativePath>
  </parent>

  <groupId>org.limepepper.chefclipse</groupId>
  <artifactId>org.limepepper.chefclipse.product</artifactId>
  <version>1.0.0-SNAPSHOT</version>
  <packaging>eclipse-repository</packaging>
    <description>
This is the installer for the chefclipse RCP app
    </description>
    <organization>
        <name>Lime Pepper Ltd</name>
        <url>http://www.limepepper.co.uk</url>
    </organization>

  <build>
    <plugins>
       <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>tycho-p2-director-plugin</artifactId>
        <version>${tycho-version}</version>

        <executions>
          <execution>
            <id>materialize-products</id>
            <goals>
              <goal>materialize-products</goal>
            </goals>
          </execution>
          <!--execution>
            <id>archive-products</id>
            <goals>
              <goal>archive-products</goal>
            </goals>
          </execution-->
        </executions>
        <configuration>
          <products>
            <product>
              <id>org.limepepper.chefclipse.product</id>
              <attachId>other</attachId>

              <!-- optional parameters (with default values)  -->
              <rootFolder></rootFolder>
            </product>
          </products>
          <!-- global optional parameters (with default values) -->
          <installFeatures>true</installFeatures>
          <profile>DefaultProfile</profile>
        </configuration>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-antrun-plugin</artifactId>
        <executions>
          <execution>
            <id>izpack</id>
             <phase>package</phase>
            <configuration>
              <tasks>
               <echo message="Starting Ant izPack build ..." />
               <property name="plugin_classpath" refid="maven.plugin.classpath"/>
               <property name="project.build.dir" value="${project.build.directory}" />
               
               <ant antfile="${basedir}/src/main/izpack/izpack-build.xml" inheritAll="true" inheritRefs="true">
                  <target name="build.bundles"/>
                </ant>
                <exec executable="fpm">
                	<arg line="-s dir -t deb -C target/products/org.limepepper.chefclipse.product/linux/gtk/x86_64/ -a amd64 -n chefclipse --prefix /usr/lib/chefclipse -p target/chefclipse_1.0_amd64.deb ." />
                </exec>
                <exec executable="fpm">
                	<arg line="-s dir -t deb -C target/products/org.limepepper.chefclipse.product/linux/gtk/x86/ -a i386 -n chefclipse --prefix /usr/lib/chefclipse -p target/chefclipse_1.0_i386.deb ." />
                </exec>
                <exec executable="fpm">
                	<arg line="-s dir -t rpm -C target/products/org.limepepper.chefclipse.product/linux/gtk/x86_64/ -a x86_64 -n chefclipse --prefix /usr/lib/chefclipse -p target/chefclipse_1.0_amd64.rpm ." />
                </exec>
                <exec executable="fpm">
                	<arg line="-s dir -t rpm -C target/products/org.limepepper.chefclipse.product/linux/gtk/x86/ -a i686 -n chefclipse --prefix /usr/lib/chefclipse -p target/chefclipse_1.0_i686.rpm ." />
                </exec>
              </tasks>
            </configuration>
            <goals>
              <goal>run</goal>
            </goals>
          </execution>
        </executions>
		<dependencies>
			<dependency>
				<groupId>ant-contrib</groupId>
				<artifactId>ant-contrib</artifactId>
				<version>1.0b3</version>
				<exclusions>
					<exclusion>
						<groupId>ant</groupId>
						<artifactId>ant</artifactId>
					</exclusion>
				</exclusions>
			</dependency>
			<dependency>
				<groupId>ant</groupId>
				<artifactId>ant-nodeps</artifactId>
				<version>1.6.5</version>
			</dependency>
			<dependency>
				<groupId>org.codehaus.izpack</groupId>
				<artifactId>izpack-maven-plugin</artifactId>
				<version>5.0.0-beta11</version>
			</dependency>
			<dependency>
				<groupId>org.codehaus.izpack</groupId>
				<artifactId>izpack-ant</artifactId>
				<version>5.0.0-beta11</version>
			</dependency>
	
		</dependencies>
        
      </plugin>
               <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>rpm-maven-plugin</artifactId>
                <version>2.1-alpha-2</version>
                <executions>
                    <execution>
                        <goals>
                            <goal>rpm</goal>
                        </goals>
                    </execution>
                </executions>
                <configuration>
                    <copyright>2013, Lime Pepper Ltd</copyright>
                    <distribution>Trash 2013</distribution>
                    <group>Text Editors/Integrated Development Environments (IDE)</group>
                    <icon>icons/48x48.xpm</icon>
                    <packager>tolland</packager>
                    <needarch>x86_64</needarch>
                    <prefix>/usr/share</prefix>
                    <changelogFile>src/CHANGELOG</changelogFile>
                    <defineStatements>
						<defineStatement>_unpackaged_files_terminate_build 0</defineStatement>
						<defineStatement>QA_RPATHS [ 0x0001|0x0010 ]</defineStatement>
						<defineStatement>QA_CHECK_RPATHS 0</defineStatement>
						<defineStatement>__spec_install_post %{nil}</defineStatement>
						<defineStatement>debug_package %{nil}</defineStatement>
						<defineStatement>__os_install_post %{_dbpath}/brp-compress</defineStatement>
                       
                    </defineStatements>
                    <mappings>
                        <mapping>
                            <directory>/usr/share/chefclipse</directory>
                            <filemode>755</filemode>
                            <username>root</username>
                            <groupname>root</groupname>
                            <sources>
                                <source>
                                    <location>target/products/org.limepepper.chefclipse.product/linux/gtk/x86_64</location>
                                </source>
                            </sources>
                        </mapping>
                        
                       <mapping>
                            <directory>/usr/share/applications/</directory>
                            <filemode>644</filemode>
                            <username>root</username>
                            <groupname>root</groupname>
                            <sources>
                            <source>
                                <location>src/chefclipse.desktop</location>
                                <targetArchitecture>x86_64</targetArchitecture>
                            </source>
                            <!--source>
                                <location>src/main/native/i586</location>
                                <targetArchitecture>i586</targetArchitecture>
                            </source-->
                                <!--softlinkSource>
                                    <location>/usr/local/bin/new.sh</location>
                                    <destination>old.sh</destination>
                                </softlinkSource-->
                            </sources>
                        </mapping>
                    </mappings>
                    <preinstallScriptlet>
                        <script>echo "installing now"</script>
                    </preinstallScriptlet>
                    <postinstallScriptlet>
                        <scriptFile>src/main/scripts/postinstall</scriptFile>
                        <fileEncoding>utf-8</fileEncoding>
                    </postinstallScriptlet>
                    <!--preremoveScriptlet>
                        <scriptFile>src/main/scripts/preremove</scriptFile>
                        <fileEncoding>utf-8</fileEncoding>
                    </preremoveScriptlet-->
                    <requires>
						<require>java-devel &gt;= 1.7.0</require>
						<require>git &gt;= 1.7.0</require>
						<require>ruby</require>
				</requires>
                </configuration>
            </plugin>
    </plugins>
  </build>

</project>
